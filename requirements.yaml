# DemaConsulting.SpdxTool Requirements
#
# This project uses three categories of tests to verify requirements:
#
# 1. Unit Tests - Run locally via "dotnet test"
# 2. Self-Validation Tests - Run locally via "--validate"
# 3. Platform Tests - Run via CI/CD across OS/runtime matrix
#
# NOTE: Running "reqstream --enforce" with only local test results (unit tests
# and local self-validation) is expected to show some unsatisfied requirements.
# Platform-specific requirements require test results from CI/CD runs across
# the full OS and runtime matrix.
#
# Test links can include a source filter prefix (e.g. "windows@", "ubuntu@", "net8.0@",
# "dotnet8.x@") to restrict which test results count as evidence for a requirement. This
# is critical for platform and framework requirements - removing these filters invalidates
# the evidence-based proof.
#
# Source filter prefixes:
#   windows@TestName    - proves the test passed on a Windows platform
#   ubuntu@TestName     - proves the test passed on a Linux (Ubuntu) platform
#   net8.0@TestName     - proves the test passed under the .NET 8 target framework
#   net9.0@TestName     - proves the test passed under the .NET 9 target framework
#   net10.0@TestName    - proves the test passed under the .NET 10 target framework
#   dotnet8.x@TestName  - proves the self-validation test ran with .NET 8.x runtime
#   dotnet9.x@TestName  - proves the self-validation test ran with .NET 9.x runtime
#   dotnet10.x@TestName - proves the self-validation test ran with .NET 10.x runtime
#
---
sections:
  - title: SpdxTool Requirements
    sections:
      - title: Command-Line Interface
        requirements:
          - id: SPDX-REQ-001
            title: The tool shall display version information when invoked with the -v flag.
            tags:
              - cli
            justification: |
              Users need to check the version of the tool they are using for compatibility
              and troubleshooting purposes. The short flag provides a convenient way to
              access this information.
            tests:
              - Version_ShortFlag_DisplaysVersion

          - id: SPDX-REQ-002
            title: The tool shall display version information when invoked with the --version flag.
            tags:
              - cli
            justification: |
              Users need to check the version of the tool they are using for compatibility
              and troubleshooting purposes. The long flag provides a more descriptive
              alternative to the short flag.
            tests:
              - Version_LongFlag_DisplaysVersion

          - id: SPDX-REQ-003
            title: The tool shall display usage information when invoked with the -h flag.
            tags:
              - cli
            justification: |
              Users need quick access to help documentation to understand how to use the
              tool effectively. The short flag provides a convenient way to access help.
            tests:
              - Usage_ShortHelpFlag_DisplaysUsage

          - id: SPDX-REQ-004
            title: The tool shall display usage information when invoked with the --help flag.
            tags:
              - cli
            justification: |
              Users need quick access to help documentation to understand how to use the
              tool effectively. The long flag provides a more descriptive alternative.
            tests:
              - Usage_LongHelpFlag_DisplaysUsage

          - id: SPDX-REQ-005
            title: The tool shall display an error and usage information when invoked without arguments.
            tags:
              - cli
            justification: |
              When users invoke the tool without any arguments, they should receive
              guidance on proper usage rather than encountering undefined behavior.
            tests:
              - Usage_NoArguments_DisplaysError

          - id: SPDX-REQ-006
            title: The tool shall silence console output when invoked with the -s flag.
            tags:
              - cli
            justification: |
              In automated scripts and CI/CD pipelines, users may want to suppress
              console output to reduce log noise. The short flag provides a convenient
              way to enable silent mode.
            tests:
              - Silent_ShortFlag_SuppressesOutput

          - id: SPDX-REQ-007
            title: The tool shall silence console output when invoked with the --silent flag.
            tags:
              - cli
            justification: |
              In automated scripts and CI/CD pipelines, users may want to suppress
              console output to reduce log noise. The long flag provides a more
              descriptive alternative.
            tests:
              - Silent_LongFlag_SuppressesOutput

          - id: SPDX-REQ-008
            title: The tool shall write output to a log file when invoked with the -l flag.
            tags:
              - cli
            justification: |
              Users need the ability to capture tool output to files for auditing,
              debugging, and record-keeping purposes. The short flag provides a
              convenient way to enable logging.
            tests:
              - Log_ShortFlag_WritesOutputToFile

          - id: SPDX-REQ-009
            title: The tool shall write output to a log file when invoked with the --log flag.
            tags:
              - cli
            justification: |
              Users need the ability to capture tool output to files for auditing,
              debugging, and record-keeping purposes. The long flag provides a more
              descriptive alternative.
            tests:
              - Log_LongFlag_WritesOutputToFile

          - id: SPDX-REQ-010
            title: The tool shall perform self-validation when invoked with the --validate flag.
            tags:
              - cli
            justification: |
              Self-validation ensures that the tool functions correctly after installation
              or deployment. This is critical for CI/CD pipelines and quality assurance.
            tests:
              - SelfValidation_ValidateFlag_Succeeds

          - id: SPDX-REQ-011
            title: The tool shall support depth control for self-validation output.
            tags:
              - cli
            justification: |
              Users may want to see detailed hierarchical results during self-validation
              to understand which specific tests passed or failed at different depths.
            tests:
              - SelfValidation_ValidateFlagWithDepth_ShowsDepth

          - id: SPDX-REQ-012
            title: The tool shall write self-validation results to a TRX file when invoked with the -r or --result flag.
            tags:
              - cli
            justification: |
              CI/CD systems and test reporting tools often require test results in
              standardized formats like TRX. This enables integration with existing
              test infrastructure.
            tests:
              - SelfValidation_ValidateFlagWithResults_GeneratesTrxFile

      - title: SPDX Document Validation
        requirements:
          - id: SPDX-REQ-013
            title: The tool shall validate SPDX documents using the validate command.
            tags:
              - spdx
            justification: |
              Users need to verify that SPDX documents conform to the SPDX specification
              before using them in downstream processes or sharing them with others.
            tests:
              - SpdxTool_Validate

          - id: SPDX-REQ-014
            title: The tool shall validate SPDX documents against NTIA minimum elements requirements.
            tags:
              - spdx
            justification: |
              The NTIA (National Telecommunications and Information Administration) has
              defined minimum elements for SBOM. Users need to verify compliance with
              these requirements for regulatory and industry standards.
            tests:
              - SpdxTool_Ntia

      - title: SPDX Package Management
        requirements:
          - id: SPDX-REQ-015
            title: The tool shall add packages to SPDX documents using the add-package command.
            tags:
              - spdx
            justification: |
              Users need to incrementally build SPDX documents by adding new packages
              that represent software components, libraries, or dependencies.
            tests:
              - SpdxTool_AddPackage

          - id: SPDX-REQ-016
            title: The tool shall copy packages between SPDX documents using the copy-package command.
            tags:
              - spdx
            justification: |
              Users need to reuse package information across multiple SPDX documents
              to avoid duplication and ensure consistency of package metadata.
            tests:
              - SpdxTool_CopyPackage

          - id: SPDX-REQ-017
            title: The tool shall update existing packages in SPDX documents using the update-package command.
            tags:
              - spdx
            justification: |
              Users need to modify package metadata as software components evolve,
              such as updating versions, licenses, or other attributes.
            tests:
              - SpdxTool_UpdatePackage

          - id: SPDX-REQ-018
            title: The tool shall find packages in SPDX documents using the find-package command.
            tags:
              - spdx
            justification: |
              Users need to locate specific packages within SPDX documents based on
              criteria such as name, version, or other attributes to query or modify them.
            tests:
              - SpdxTool_FindPackage

          - id: SPDX-REQ-019
            title: The tool shall retrieve package versions from SPDX documents using the get-version command.
            tags:
              - spdx
            justification: |
              Users need to extract version information from packages for reporting,
              dependency management, and compatibility checking.
            tests:
              - SpdxTool_GetVersion

      - title: SPDX Relationship Management
        requirements:
          - id: SPDX-REQ-020
            title: The tool shall add relationships to SPDX documents using the add-relationship command.
            tags:
              - spdx
            justification: |
              SPDX documents describe relationships between packages, files, and other
              elements. Users need to define these relationships to accurately represent
              dependency graphs and component hierarchies.
            tests:
              - SpdxTool_AddRelationship

      - title: SPDX Document Transformation
        requirements:
          - id: SPDX-REQ-021
            title: The tool shall convert SPDX documents to Markdown format using the to-markdown command.
            tags:
              - spdx
            justification: |
              Users need human-readable representations of SPDX documents for
              documentation, reporting, and review purposes. Markdown is a widely
              supported format for documentation.
            tests:
              - SpdxTool_ToMarkdown

          - id: SPDX-REQ-022
            title: The tool shall generate Mermaid diagrams from SPDX documents using the diagram command.
            tags:
              - spdx
            justification: |
              Visual representations of SPDX relationships and package hierarchies
              help users understand complex dependency graphs. Mermaid is a popular
              text-based diagramming language.
            tests:
              - SpdxTool_Diagram

      - title: SPDX Document Manipulation
        requirements:
          - id: SPDX-REQ-023
            title: The tool shall rename SPDX element IDs using the rename-id command.
            tags:
              - spdx
            justification: |
              Users need to modify element IDs to resolve conflicts, follow naming
              conventions, or reorganize SPDX documents while maintaining referential
              integrity.
            tests:
              - SpdxTool_RenameId

      - title: File Hashing
        requirements:
          - id: SPDX-REQ-024
            title: The tool shall compute and verify file hashes using the hash command.
            tags:
              - spdx
            justification: |
              SPDX documents often include file hashes for integrity verification.
              Users need to compute hashes using various algorithms and verify that
              files match expected hash values.
            tests:
              - SpdxTool_Hash

      - title: Workflow Support
        requirements:
          - id: SPDX-REQ-025
            title: The tool shall execute workflow files using the run-workflow command.
            tags:
              - workflow
            justification: |
              Complex SPDX document operations often require multiple steps. Workflows
              enable users to define and automate multi-step processes in a declarative
              YAML format.
            tests:
              - SpdxTool_AddPackage
              - SpdxTool_AddRelationship
              - SpdxTool_CopyPackage
              - SpdxTool_UpdatePackage

          - id: SPDX-REQ-026
            title: The tool shall support setting variables within workflows using the set-variable command.
            tags:
              - workflow
            justification: |
              Workflows need to pass data between steps and parameterize operations.
              Variables enable dynamic workflow execution based on computed or input values.
            tests:
              - SpdxTool_AddPackage

          - id: SPDX-REQ-027
            title: The tool shall support printing text within workflows using the print command.
            tags:
              - workflow
            justification: |
              Users need to output informational messages during workflow execution
              for debugging, progress tracking, and user feedback.
            tests:
              - SpdxTool_AddPackage

          - id: SPDX-REQ-028
            title: The tool shall support querying external program output using the query command.
            tags:
              - workflow
            justification: |
              Workflows often need to extract information from external tools or
              commands to incorporate into SPDX documents or workflow logic.
            tests:
              - SpdxTool_Query

      - title: Platform Support
        requirements:
          - id: SPDX-REQ-029
            title: The tool shall run successfully on Windows platforms.
            tags:
              - platform
            justification: |
              Windows is a widely used operating system for development. The tool
              must function correctly on Windows to support a broad user base.
            tests:
              - windows@SpdxTool_Validate

          - id: SPDX-REQ-030
            title: The tool shall run successfully on Linux platforms.
            tags:
              - platform
            justification: |
              Linux is a widely used operating system for development and deployment,
              especially in CI/CD environments. The tool must function correctly on
              Linux to support a broad user base.
            tests:
              - ubuntu@SpdxTool_Validate

          - id: SPDX-REQ-031
            title: The tool shall run successfully on .NET 8.x.
            tags:
              - platform
            justification: |
              .NET 8.x is a long-term support (LTS) release of .NET. The tool must
              support this version to provide stability and compatibility for users
              who require LTS support.
            tests:
              - dotnet8.x@SpdxTool_Validate

          - id: SPDX-REQ-032
            title: The tool shall run successfully on .NET 9.x.
            tags:
              - platform
            justification: |
              .NET 9.x is a current release of .NET. The tool must support this
              version to enable users to take advantage of the latest .NET features
              and improvements.
            tests:
              - dotnet9.x@SpdxTool_Validate

          - id: SPDX-REQ-033
            title: The tool shall run successfully on .NET 10.x.
            tags:
              - platform
            justification: |
              .NET 10.x represents forward compatibility. The tool should support
              future .NET releases to ensure users can upgrade their runtime without
              losing tool functionality.
            tests:
              - dotnet10.x@SpdxTool_Validate

      - title: MSBuild Targets Integration
        requirements:
          - id: SPDX-REQ-034
            title: The MSBuild targets package shall decorate SBOMs during dotnet pack for single-TFM projects.
            tags:
              - msbuild
              - sbom
            justification: |
              Users building single-target framework projects need SBOM decoration
              integrated into their standard build process without manual intervention.
              Automatic decoration during pack ensures SBOMs are consistently enhanced.
            tests:
              - SingleTfmProject_DecorateSbomTrue_DecoratesSbom

          - id: SPDX-REQ-035
            title: The MSBuild targets package shall decorate SBOMs during dotnet pack for multi-TFM projects.
            tags:
              - msbuild
              - sbom
            justification: |
              Users building multi-target framework projects need SBOM decoration
              to work correctly across all target frameworks. This ensures consistent
              SBOM enhancement regardless of project complexity.
            tests:
              - MultiTfmProject_DecorateSbomTrue_DecoratesSbom

          - id: SPDX-REQ-036
            title: The MSBuild targets package shall skip SBOM decoration when DecorateSBOM is false.
            tags:
              - msbuild
              - sbom
            justification: |
              Users must be able to opt-out of SBOM decoration for projects where it is
              not needed or desired. The default behavior respects user choice by not
              decorating unless explicitly enabled.
            tests:
              - SingleTfmProject_DecorateSbomFalse_SkipsDecoration

          - id: SPDX-REQ-037
            title: The MSBuild targets package shall skip SBOM decoration when GenerateSBOM is false.
            tags:
              - msbuild
              - sbom
            justification: |
              SBOM decoration depends on SBOM generation being enabled. When no SBOM
              is generated, decoration should be skipped entirely to avoid errors and
              unnecessary processing.
            tests:
              - SingleTfmProject_GenerateSbomFalse_SkipsEntirely

          - id: SPDX-REQ-038
            title: The MSBuild targets package shall report a clear error when the workflow file is missing.
            tags:
              - msbuild
              - sbom
            justification: |
              When users enable SBOM decoration but the required workflow file is not
              present, they need a clear error message to understand the problem and
              take corrective action.
            tests:
              - SingleTfmProject_MissingWorkflow_ReportsError

          - id: SPDX-REQ-039
            title: The MSBuild targets package shall work correctly on Windows platforms.
            tags:
              - msbuild
              - platform
            justification: |
              Windows is a widely used operating system for .NET development. The
              MSBuild integration must function correctly on Windows to support
              developers using this platform.
            tests:
              - windows@SingleTfmProject_DecorateSbomTrue_DecoratesSbom
              - windows@MultiTfmProject_DecorateSbomTrue_DecoratesSbom
              - windows@SingleTfmProject_DecorateSbomFalse_SkipsDecoration
              - windows@SingleTfmProject_GenerateSbomFalse_SkipsEntirely
              - windows@SingleTfmProject_MissingWorkflow_ReportsError

          - id: SPDX-REQ-040
            title: The MSBuild targets package shall work correctly on Linux platforms.
            tags:
              - msbuild
              - platform
            justification: |
              Linux is a widely used operating system for .NET development and CI/CD
              environments. The MSBuild integration must function correctly on Linux
              to support developers and automation using this platform.
            tests:
              - ubuntu@SingleTfmProject_DecorateSbomTrue_DecoratesSbom
              - ubuntu@MultiTfmProject_DecorateSbomTrue_DecoratesSbom
              - ubuntu@SingleTfmProject_DecorateSbomFalse_SkipsDecoration
              - ubuntu@SingleTfmProject_GenerateSbomFalse_SkipsEntirely
              - ubuntu@SingleTfmProject_MissingWorkflow_ReportsError
